{"version":3,"sources":["webpack:///./src/pages/doc/authorization/mutations.mdx"],"names":["_frontmatter","layoutProps","MDXLayout","DefaultLayout","MDXContent","components","props","mdxType","pageContext","frontmatter","title","parentName","isMDXComponent"],"mappings":"gRAMO,IAAMA,EAAe,GAOtBC,EAAc,CAClBD,gBAEIE,EAAYC,IACH,SAASC,EAAT,GAGZ,IAFDC,EAEC,EAFDA,WACGC,E,oIACF,mBACD,OAAO,YAACJ,EAAD,iBAAeD,EAAiBK,EAAhC,CAAuCD,WAAYA,EAAYE,QAAQ,cAG5E,sBAAKD,EAAME,YAAYC,YAAYC,OACnC,gNACA,6BACA,kCAAiB,0BAAYC,WAAW,KAAvB,OAAjB,sHACA,qDACA,uBAAK,kCAAMA,WAAW,OAAU,CAC5B,UAAa,qBADZ,yXAuBL,gHAA+F,0BAAYA,WAAW,KAAvB,OAA/F,uFACA,gCACA,uIAAsH,0BAAYA,WAAW,KAAvB,UAAtH,mBACA,qHAAoG,0BAAYA,WAAW,KAAvB,SAApG,UACA,uBAAK,kCAAMA,WAAW,OAAU,CAC5B,UAAa,qBADZ,8fA0BL,4CACA,uBAAK,kCAAMA,WAAW,OAAU,CAC5B,UAAa,qBADZ,+GAQL,wNACA,0IACA,gCACA,qGACA,kSAAiR,0BAAYA,WAAW,KAAvB,SAAjR,4GAA+a,0BAAYA,WAAW,KAAvB,SAA/a,iEACA,oDAAmC,0BAAYA,WAAW,KAAvB,UAAnC,UAAgG,kBAAIA,WAAW,KAAf,UAAhG,oGAAuO,0BAAYA,WAAW,KAAvB,UAAvO,mIACA,wCACA,4JACA,uBAAK,kCAAMA,WAAW,OAAU,CAC5B,UAAa,qBADZ,mLAWL,qJAAoI,kBAAIA,WAAW,KAAf,OAApI,0EACA,wBAKJP,EAAWQ,gBAAiB","file":"component---src-pages-doc-authorization-mutations-mdx-78efdb3e69133b088d97.js","sourcesContent":["import * as React from 'react'\n  /* @jsx mdx */\nimport { mdx } from '@mdx-js/react';\n/* @jsx mdx */\n\nimport DefaultLayout from \"/Users/debabrata/Sites/Projects/Dgraph/graphql-dgraph-web/src/components/layout.js\";\nexport const _frontmatter = {};\n\nconst makeShortcode = name => function MDXDefaultShortcode(props) {\n  console.warn(\"Component \" + name + \" was not imported, exported, or provided by MDXProvider as global scope\");\n  return <div {...props} />;\n};\n\nconst layoutProps = {\n  _frontmatter\n};\nconst MDXLayout = DefaultLayout;\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n\n    <h1>{props.pageContext.frontmatter.title}</h1>\n    <p>{`Mutations with auth work similarly to query.  However, mutations involve a state change in the database, so it's important to understand when the rules are applied and what they mean.`}</p>\n    <h2>{`Add`}</h2>\n    <p>{`Rules for `}<inlineCode parentName=\"p\">{`add`}</inlineCode>{` authorization state that the rule must hold of nodes created by the mutation data once committed to the database.`}</p>\n    <p>{`For example, a rule such as:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-graphql\"\n      }}>{`type Todo @auth(\n    add: { rule: \"\"\"\n        query ($USER: String!) { \n            queryTodo {\n                owner(filter: { username: { eq: $USER } } ) { \n                    username\n                } \n            } \n        }\"\"\"\n    }\n){{\n    id: ID!\n    text: String!\n    owner: User\n}\n\ntype User {\n    username: String! @id\n    todos: [Todo]\n}\n`}</code></pre>\n    <p>{`states that if you add a new todo, then that new todo must be a todo that satisfies the `}<inlineCode parentName=\"p\">{`add`}</inlineCode>{` rule, in this case saying that you can only add todos with yourself as the author.`}</p>\n    <h2>{`Delete`}</h2>\n    <p>{`Delete rules filter the nodes that can be deleted.  A user can only ever delete a subset of the nodes that the `}<inlineCode parentName=\"p\">{`delete`}</inlineCode>{` rules allow.  `}</p>\n    <p>{`For example, this rule states that a user can delete a todo if they own it, or they have the `}<inlineCode parentName=\"p\">{`ADMIN`}</inlineCode>{` role.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-graphql\"\n      }}>{`type Todo @auth(\n    delete: { or: [ \n        { rule: \"\"\"\n            query ($USER: String!) { \n                queryTodo {\n                    owner(filter: { username: { eq: $USER } } ) { \n                        username\n                    } \n                } \n            }\"\"\"\n        },\n        { rule:  \"{$ROLE: { eq: \\\\\"ADMIN\\\\\" } }\"}\n    ]}\n){{\n    id: ID!\n    text: String! @search(by: [term])\n    owner: User\n}\n\ntype User {\n    username: String! @id\n    todos: [Todo]\n}\n`}</code></pre>\n    <p>{`So a mutation like:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-graphql\"\n      }}>{`mutation {\n    deleteTodo(filter: { text: { anyofterms: \"graphql\" } }) {\n        numUids    \n    }\n}\n`}</code></pre>\n    <p>{`for most users would delete their own posts that contain the term \"graphql\", but wouldn't affect any other user's todos; for an admin, it would delete any users posts that contain \"graphql\"`}</p>\n    <p>{`For add, what matters is the resulting state of the database, for delete it's the state before the delete occurs.`}</p>\n    <h2>{`Update`}</h2>\n    <p>{`Updates have both a before and after state that can be important for auth.  `}</p>\n    <p>{`For example, consider a rule stating that you can only update your own todos.  If evaluated in the database before the mutation, like the delete rules, it would prevent you updating anyone elses todos, but does it stop you updating your own todo to have a different `}<inlineCode parentName=\"p\">{`owner`}</inlineCode>{`.  If evaluated in the database after the mutation occurs, like for add rules, it would stop setting the `}<inlineCode parentName=\"p\">{`owner`}</inlineCode>{` to another user, but would it prevent editing other's posts.`}</p>\n    <p>{`Currently, Dgraph evaluates `}<inlineCode parentName=\"p\">{`update`}</inlineCode>{` rules `}<em parentName=\"p\">{`before`}</em>{` the mutation.  Our auth support is still in beta and we may extend this for example to make the `}<inlineCode parentName=\"p\">{`update`}</inlineCode>{` rule an invariant of the mutation, or enforce pre and post conditions, or even allow custom logic to validate the update data.`}</p>\n    <h2>{`Update and Add`}</h2>\n    <p>{`Update mutations can also insert new data.  For example, you might allow a mutation that runs an update mutation to add a new todo.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-graphql\"\n      }}>{`mutation {\n    updateUser(input: {\n        filter: { username: { eq: \"aUser\" }},\n        set: { todos: [ { text: \"do this new todo\"} ] }\n    }) {\n        ...\n    }\n}\n`}</code></pre>\n    <p>{`Such a mutation updates a user's todo list by inserting a new todo.  It would have to satisfy the rules to update the author `}<em parentName=\"p\">{`and`}</em>{` the rules to add a todo.  If either fail, the mutation has no effect.`}</p>\n    <hr></hr>\n\n    </MDXLayout>;\n}\n;\nMDXContent.isMDXComponent = true;\n      "],"sourceRoot":""}