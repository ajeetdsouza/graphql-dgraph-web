{"version":3,"sources":["webpack:///./src/pages/doc/custom/mutation.mdx"],"names":["_frontmatter","layoutProps","MDXLayout","DefaultLayout","MDXContent","components","props","mdxType","pageContext","frontmatter","title","parentName","isMDXComponent"],"mappings":"gRAMO,IAAMA,EAAe,GAOtBC,EAAc,CAClBD,gBAEIE,EAAYC,IACH,SAASC,EAAT,GAGZ,IAFDC,EAEC,EAFDA,WACGC,E,oIACF,mBACD,OAAO,YAACJ,EAAD,iBAAeD,EAAiBK,EAAhC,CAAuCD,WAAYA,EAAYE,QAAQ,cAG5E,sBAAKD,EAAME,YAAYC,YAAYC,OACnC,0OACA,uBAAK,kCAAMC,WAAW,OAAU,CAC5B,UAAa,qBADZ,wJAaL,4CAA2B,0BAAYA,WAAW,KAAvB,WAA3B,qFAAoK,0BAAYA,WAAW,KAAvB,UAApK,2GAAkU,0BAAYA,WAAW,KAAvB,iBAAlU,iLAA6iB,0BAAYA,WAAW,KAAvB,SAA7iB,OAAsmB,0BAAYA,WAAW,KAAvB,QAAtmB,+EACA,gXAA+V,0BAAYA,WAAW,KAAvB,iBAA/V,mBAA4a,0BAAYA,WAAW,KAAvB,UAA5a,oFAAmjB,0BAAYA,WAAW,KAAvB,WAAnjB,qHACA,kFACA,uBAAK,kCAAMA,WAAW,OAAU,CAC5B,UAAa,qBADZ,kQAWL,kJACA,wBAKJP,EAAWQ,gBAAiB","file":"component---src-pages-doc-custom-mutation-mdx-c43621b0dc369b53e1a9.js","sourcesContent":["import * as React from 'react'\n  /* @jsx mdx */\nimport { mdx } from '@mdx-js/react';\n/* @jsx mdx */\n\nimport DefaultLayout from \"/Users/debabrata/Sites/Projects/Dgraph/graphql-dgraph-web/src/components/layout.js\";\nexport const _frontmatter = {};\n\nconst makeShortcode = name => function MDXDefaultShortcode(props) {\n  console.warn(\"Component \" + name + \" was not imported, exported, or provided by MDXProvider as global scope\");\n  return <div {...props} />;\n};\n\nconst layoutProps = {\n  _frontmatter\n};\nconst MDXLayout = DefaultLayout;\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n\n    <h1>{props.pageContext.frontmatter.title}</h1>\n    <p>{`Let's say we have an application about authors and posts.  Logged in authors can add posts, but we want to do some input validation and add extra value when a post is added.  The key types might be as follows.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-graphql\"\n      }}>{`type Author { ... }\n\ntype Post {\n    id: ID:\n    title: String\n    text: String\n    datePublished: DateTime\n    author: Author\n    ...\n}\n`}</code></pre>\n    <p>{`Dgraph generates an `}<inlineCode parentName=\"p\">{`addPost`}</inlineCode>{` mutation from those types, but we want to do something extra.  We don't want the `}<inlineCode parentName=\"p\">{`author`}</inlineCode>{` to come in with the mutation, that should get filled in from the JWT of the logged in user.  Also, the `}<inlineCode parentName=\"p\">{`datePublished`}</inlineCode>{` shouldn't be in the input; it should be set as the current time at point of mutation.  Maybe we also have some community guidelines about what might constitute an offensive `}<inlineCode parentName=\"p\">{`title`}</inlineCode>{` or `}<inlineCode parentName=\"p\">{`text`}</inlineCode>{` in a post. Maybe users can only post if they have enough community credit.`}</p>\n    <p>{`We'll need custom code to do all that, so we can write a custom function that takes in only the title and text of the new post.  Internally, it can check that the title and text satisfy the guidelines and that this user has enough credit to make a post. If those checks pass, it then builds a full post object by adding the current time as the `}<inlineCode parentName=\"p\">{`datePublished`}</inlineCode>{` and adding the `}<inlineCode parentName=\"p\">{`author`}</inlineCode>{` from the JWT information it gets from the forward header.  It can then call the `}<inlineCode parentName=\"p\">{`addPost`}</inlineCode>{` mutation constructed by Dgraph to add the post into Dgraph and returns the resulting post as its GraphQL output.`}</p>\n    <p>{`So as well as the types above, we need a custom mutation:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-graphql\"\n      }}>{`type Mutation {\n    newPost(title: String!, text: String): Post @custom(http:{\n        url: \"https://my.api.com/addPost\"\n        method: \"POST\",\n        body: \"{ postText: $text, postTitle: $title }\"\n        forwardHeaders: [\"AuthHdr\"]\n    })\n}\n`}</code></pre>\n    <p>{`(Note: there's more docs coming about turning off the generated mutations, protecting them with authorization rules etc.)`}</p>\n    <hr></hr>\n\n    </MDXLayout>;\n}\n;\nMDXContent.isMDXComponent = true;\n      "],"sourceRoot":""}